import pandas as pd

# Load dataset
df = pd.read_csv('customer_personality_raw.csv')

# 1. Identify and handle missing values
print("Missing values per column:\n", df.isnull().sum())
df = df.dropna()  # Drop rows with any missing value (or customize fillna as needed)

# 2. Remove duplicates
before = df.shape[0]
df = df.drop_duplicates()
after = df.shape[0]
print(f"Removed {before - after} duplicate rows.")

# 3. Standardize text values: gender, country, name
df['gender'] = df['gender'].str.lower().str.strip()
df['country'] = df['country'].str.lower().str.strip()

# Normalize country names
country_replacements = {
    'usa': 'united states',
    'us': 'united states',
    'united states of america': 'united states',
    'ca': 'canada'
}
df['country'] = df['country'].replace(country_replacements)
df['country'] = df['country'].str.title()  # Capitalize each word

# Normalize names (capitalize)
df['name'] = df['name'].str.title()

# 4. Convert 'signup_date' to datetime type with consistent format
df['signup_date'] = pd.to_datetime(df['signup_date'], errors='coerce')
df = df.dropna(subset=['signup_date'])  # Remove if date conversion failed

# 5. Rename columns to lower case and underscores
df.columns = df.columns.str.lower().str.replace(' ', '_')

# 6. Fix data types
df['age'] = pd.to_numeric(df['age'], errors='coerce').astype('Int64')
df['income'] = pd.to_numeric(df['income'], errors='coerce').astype('Float64')

# Final cleaned data output
df.to_csv('customer_personality_cleaned.csv', index=False)
print("Cleaned data saved to customer_personality_cleaned.csv")
